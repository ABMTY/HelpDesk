<!DOCTYPE html>
<html>
<head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>@ViewBag.Title - HelpDesk </title>
    <!-- Tell the browser to be responsive to screen width -->
    <meta content="width=device-width, initial-scale=1, maximum-scale=1, user-scalable=no" name="viewport">
    <!-- jQuery 2.1.4 -->
    <script src="~/Content/js/jquery-3.1.1.min.js"></script>
    <!-- Bootstrap 3.3.5 -->
    <script src="~/Content/js/bootstrap.min.js"></script>
    <!-- AdminLTE App -->
    <script src="~/Content/js/app.min.js"></script>
    <!-- Bootstrap 3.3.5 -->
    <link rel="stylesheet" href="~/Content/css/bootstrap.min.css">
    <!-- Font Awesome -->
    <link rel="stylesheet" href="~/Content/css/font-awesome.css">
    <!-- Theme style -->
    <link rel="stylesheet" href="~/Content/css/AdminLTE.min.css">
    <!-- jquery signalR-->
    <script src="~/Scripts/jquery.signalR-2.2.2.js"></script>
    <!-- jquery signalR hubs-->
    <script src="/signalr/hubs"></script>
    <!-- AdminLTE Skins. Choose a skin from the css/skins
         folder instead of downloading all of them to reduce the load. -->    
    <link rel="stylesheet" href="~/Content/css/_all-skins.min.css">
    <link rel="apple-touch-icon" href="~/Content/img/apple-touch-icon.png">
    <link rel="shortcut icon" href="~/Content/img/favicon.ico">
    <link href="~/Content/css/ionicons.css" rel="stylesheet" />
    <!-- Jcrop -->
    <link rel="stylesheet" href="~/Content/css/Jcrop.css" />
    <!-- Select-Picker -->
    @Styles.Render("~/Content/css/bootstrap-select.min.css")
    @Styles.Render("~/Content/plugins/bootstrap-sweetalert/sweet-alert.css")
    @Styles.Render("~/Content/plugins/bootstrap-datepicker/dist/css/bootstrap-datepicker.min.css")
    <!-- CSS DataTables -->
    @Styles.Render("~/Content/plugins/datatables/jquery.dataTables.min.css")
    @Styles.Render("~/Content/plugins/datatables/buttons.bootstrap.min.css")
    @Styles.Render("~/Content/plugins/datatables/responsive.bootstrap.min.css")

    @*@Styles.Render("~/Content/css")*@
    @Scripts.Render("~/bundles/modernizr")

    
    <script>
        //MENU DINAMICO
        $(function () {            
                Cargar_MenuPrincipal(); 
        });

        function Cargar_MenuPrincipal() {
            $.ajax({
                url: "/MenuPrincipal/GetMenuPrincipal/",
                async: true,
                dataType: "json",
                type: "POST",
                contentType: "application/json; charset=utf-8",
                success: function (data) {
                    Cargar_Permios(data.data);
                },
                error: function (request, status, error) {
                    console.log("error" + error);
                }
            });
        }

        function Cargar_Permios(ListaMenu) {
            $.ajax({
                url: "/Usuarios/GetUsuario/",
                async: true,
                dataType: "json",
                data: '{ id:' + @Session["id_usuario"] + '}',
                type: "POST",
                contentType: "application/json; charset=utf-8",
                success: function (data) {
                    Visualizar_MenuPrincipal(ListaMenu,data.data.ent_tipo_usuario.permisos_tipo_usuario)
                },
                error: function (request, status, error) {
                    console.log("error" + error);
                }
            });
        }
        function Visualizar_MenuPrincipal(ListaMenu, Permisos_Usuarios) {
            //var menu_desplegable=[];
            try {
                $.each(ListaMenu, function (x, entMenu) {
                    contador = 1;
                    $.each(Permisos_Usuarios, function (i, entPermisos) {
                        if (entPermisos.id_menu_principal==entMenu.id_menu_principal) {
                            if (entPermisos.url == entMenu.url_net) {
                                menu = "<li>" +
                                            "<a href='" + entMenu.url_net + "'>" +
                                                "<i class='" + entMenu.icono_net + "'></i>" +
                                                "<span>" + entMenu.nombre + "</span>" +
                                            "</a>" +
                                        "</li>"
                                $("#menu_principal").append(menu);
                            }
                            else {
                                if (entPermisos.menu_principal == entMenu.nombre) {
                                    if (contador == 1) {
                                        menu = " <li class='treeview'>" +
                                           "<a href='#'>" +
                                               "<i class='" + entMenu.icono_net + "'></i>" +
                                               "<span>" + entMenu.nombre + "</span>" +
                                               "<i class='fa fa-angle-left pull-right'></i>" +
                                           "</a>" +
                                           "<ul class='treeview-menu' id='submenu" + entMenu.id_menu_principal + "'>" +
                                           "</ul>" +
                                       "</li>"
                                        $("#menu_principal").append(menu);
                                        contador++;
                                        //menu_desplegable.push({ id_menu_principal: entMenu.id_menu_principal });
                                    }
                                }
                            }
                        }
                    });
                });
                Visualizar_SubMenu(Permisos_Usuarios);
                Visualizar_Ayuda_AcecaDe();       
            }
            catch (err) {
                mostrar_aviso("error", "Error al procesar los comentarios");
            }
        }

        function Visualizar_SubMenu(Permisos_Usuarios)
        {
            $.each(Permisos_Usuarios, function (i, entPermisos) {
                sub_menu = "<li><a href='"+entPermisos.url+"'><i class='fa fa-circle-o'></i>"+entPermisos.permiso+"</a></li>"
                $("#submenu"+entPermisos.id_menu_principal).append(sub_menu);
            });
        }

        function Visualizar_Ayuda_AcecaDe()
        {
            //PINTAR AYUDA Y ACERCA DE...
            menu = "<li>"+
                        "<a href='#'>"+
                            "<i class='fa fa-question-circle'></i> <span>Ayuda</span>"+
                            "<small class='label pull-right bg-red'>PDF</small>"+
                        "</a>"+
                    "</li>"+
                    "<li>"+
                        "<a href='#'>"+
                            "<i class='fa fa-info-circle'></i> <span>Acerca De...</span>"+
                            "<small class='label pull-right bg-yellow'>IT</small>"+
                        "</a>"+
                    "</li>"

            $("#menu_principal").append(menu);
        }


    </script>

</head>
<body class="hold-transition skin-blue-light sidebar-mini">
    <div class="wrapper">
        <header class="main-header">
            <!-- Logo -->
            <a href="/Home/" class="logo">
                <!-- mini logo for sidebar mini 50x50 pixels -->
                <span class="logo-mini"><img src="~/Content/img/apple-touch-icon.png" class="user-image" width="42px"></span>                
                <!-- logo for regular state and mobile devices -->                
                <img src="~/Content/img/logo_helpdesk_b.png" class="user-image" >
            </a>
            <!-- Header Navbar: style can be found in header.less -->
            <nav class="navbar navbar-static-top" role="navigation">
                <!-- Sidebar toggle button-->
                <a href="#" class="sidebar-toggle" data-toggle="offcanvas" role="button">
                    <span class="sr-only">Navegación</span>
                </a>
                <!-- Navbar Right Menu -->
                <div class="navbar-custom-menu">
                    <ul class="nav navbar-nav">
                        <!-- Messages: style can be found in dropdown.less-->
                        <li class="dropdown messages-menu">
                            <a href="#" class="dropdown-toggle" data-toggle="dropdown">
                                <i class="fa fa-envelope-o"></i>
                                <span class="label label-success">4</span>
                            </a>
                            <ul class="dropdown-menu">
                                <li class="header">You have 4 messages</li>
                                <li>
                                    <!-- inner menu: contains the actual data -->
                                    <ul class="menu">
                                        <li>
                                            <!-- start message -->
                                            <a href="#">
                                                <div class="pull-left">                                                    
                                                    <img src="~/Content/dist/img/user2-160x160.jpg" class="img-circle" alt="User Image">
                                                </div>
                                                <h4>
                                                    Support Team
                                                    <small><i class="fa fa-clock-o"></i> 5 mins</small>
                                                </h4>
                                                <p>Why not buy a new awesome theme?</p>
                                            </a>
                                        </li>
                                        <!-- end message -->
                                        <li>
                                            <a href="#">
                                                <div class="pull-left">
                                                    <img src="~/Content/dist/img/user2-160x160.jpg" class="img-circle" alt="User Image">
                                                </div>
                                                <h4>
                                                    AdminLTE Design Team
                                                    <small><i class="fa fa-clock-o"></i> 2 hours</small>
                                                </h4>
                                                <p>Why not buy a new awesome theme?</p>
                                            </a>
                                        </li>
                                        <li>
                                            <a href="#">
                                                <div class="pull-left">
                                                    <img src="~/Content/dist/img/user2-160x160.jpg" class="img-circle" alt="User Image">
                                                </div>
                                                <h4>
                                                    Developers
                                                    <small><i class="fa fa-clock-o"></i> Today</small>
                                                </h4>
                                                <p>Why not buy a new awesome theme?</p>
                                            </a>
                                        </li>
                                        <li>
                                            <a href="#">
                                                <div class="pull-left">
                                                    <img src="~/Content/dist/img/user2-160x160.jpg" class="img-circle" alt="User Image">
                                                </div>
                                                <h4>
                                                    Sales Department
                                                    <small><i class="fa fa-clock-o"></i> Yesterday</small>
                                                </h4>
                                                <p>Why not buy a new awesome theme?</p>
                                            </a>
                                        </li>
                                        <li>
                                            <a href="#">
                                                <div class="pull-left">
                                                    <img src="~/Content/dist/img/user2-160x160.jpg" class="img-circle" alt="User Image">
                                                </div>
                                                <h4>
                                                    Reviewers
                                                    <small><i class="fa fa-clock-o"></i> 2 days</small>
                                                </h4>
                                                <p>Why not buy a new awesome theme?</p>
                                            </a>
                                        </li>
                                    </ul>
                                </li>
                                <li class="footer"><a href="#">See All Messages</a></li>
                            </ul>
                        </li>
                        <!-- Notifications: style can be found in dropdown.less -->
                        <!-- Notifications: style can be found in dropdown.less -->
                        <li class="dropdown notifications-menu">
                            <a href="#" class="dropdown-toggle" data-toggle="dropdown" onclick="Obtener_Tickets()" >
                                <i class="fa fa-bell-o"></i>
                                <span class="label label-warning" id="notificaciones"></span>
                            </a>
                            <ul class="dropdown-menu" >
                                <li class="header" id="tituloNotificaciones">You have 10 notifications</li>
                                <li>
                                    <!-- inner menu: contains the actual data -->
                                    <ul class="menu" id="menuNotificaciones">                                       
                                    </ul>
                                </li>
                                <li class="footer"><a href="#">Ver todo</a></li>
                            </ul>
                        </li>
                        <!-- Tasks: style can be found in dropdown.less -->
                        <li class="dropdown tasks-menu">
                            <a href="#" class="dropdown-toggle" data-toggle="dropdown">
                                <i class="fa fa-flag-o"></i>
                                <span class="label label-danger">9</span>
                            </a>
                            <ul class="dropdown-menu">
                                <li class="header">You have 9 tasks</li>
                                <li>
                                    <!-- inner menu: contains the actual data -->
                                    <ul class="menu">
                                        <li>
                                            <!-- Task item -->
                                            <a href="#">
                                                <h3>
                                                    Design some buttons
                                                    <small class="pull-right">20%</small>
                                                </h3>
                                                <div class="progress xs">
                                                    <div class="progress-bar progress-bar-aqua" style="width: 20%" role="progressbar"
                                                         aria-valuenow="20" aria-valuemin="0" aria-valuemax="100">
                                                        <span class="sr-only">20% Complete</span>
                                                    </div>
                                                </div>
                                            </a>
                                        </li>
                                        <!-- end task item -->
                                        <li>
                                            <!-- Task item -->
                                            <a href="#">
                                                <h3>
                                                    Create a nice theme
                                                    <small class="pull-right">40%</small>
                                                </h3>
                                                <div class="progress xs">
                                                    <div class="progress-bar progress-bar-green" style="width: 40%" role="progressbar"
                                                         aria-valuenow="20" aria-valuemin="0" aria-valuemax="100">
                                                        <span class="sr-only">40% Complete</span>
                                                    </div>
                                                </div>
                                            </a>
                                        </li>
                                        <!-- end task item -->
                                        <li>
                                            <!-- Task item -->
                                            <a href="#">
                                                <h3>
                                                    Some task I need to do
                                                    <small class="pull-right">60%</small>
                                                </h3>
                                                <div class="progress xs">
                                                    <div class="progress-bar progress-bar-red" style="width: 60%" role="progressbar"
                                                         aria-valuenow="20" aria-valuemin="0" aria-valuemax="100">
                                                        <span class="sr-only">60% Complete</span>
                                                    </div>
                                                </div>
                                            </a>
                                        </li>
                                        <!-- end task item -->
                                        <li>
                                            <!-- Task item -->
                                            <a href="#">
                                                <h3>
                                                    Make beautiful transitions
                                                    <small class="pull-right">80%</small>
                                                </h3>
                                                <div class="progress xs">
                                                    <div class="progress-bar progress-bar-yellow" style="width: 80%" role="progressbar"
                                                         aria-valuenow="20" aria-valuemin="0" aria-valuemax="100">
                                                        <span class="sr-only">80% Complete</span>
                                                    </div>
                                                </div>
                                            </a>
                                        </li>
                                        <!-- end task item -->
                                    </ul>
                                </li>
                                <li class="footer">
                                    <a href="#">View all tasks</a>
                                </li>
                            </ul>
                        </li>
                        <!-- User Account: style can be found in dropdown.less -->
                        <li class="dropdown user user-menu">
                            <a href="#" class="dropdown-toggle" data-toggle="dropdown">
                                <img src="@Session["foto"]" class="user-image">
                                <span class="hidden-xs">@Session["tipo_usuario"]</span>
                            </a>
                            <ul class="dropdown-menu">
                                <!-- User image -->
                                <li class="user-header">
                                    <img id="foto_user" src="@Session["foto"]"  class="img-circle">
                                    <p>
                                        @Session["nombre_completo"]
                                        <small>@Session["sucursal"]</small>
                                    </p>
                                </li>
                                <!-- Menu Footer-->
                                <li class="user-footer">
                                    <div class="pull-right">
                                        <a href="#" data-target="#Modal_Exit" data-toggle="modal" class="btn btn-default btn-flat">Cerrar Sesión</a>                                        
                                    </div>
                                </li>
                            </ul>
                        </li>

                    </ul>
                </div>

            </nav>
        </header>
        <!-- Left side column. contains the logo and sidebar -->
        <aside class="main-sidebar">
            <!-- sidebar: style can be found in sidebar.less -->
            <section class="sidebar">               
                <!-- sidebar menu: : style can be found in sidebar.less -->
                <ul class="sidebar-menu" id="menu_principal">
                    <li class="header"></li>
                </ul>
            </section>
            <!-- /.sidebar -->
        </aside>
        <!--Contenido-->
        <!-- Content Wrapper. Contains page content -->
        <div class="content-wrapper">
            <!-- Main content -->
            <section class="content">
                @RenderBody()
            </section><!-- /.content -->
        </div><!-- /.content-wrapper -->
        <!--Fin-Contenido-->
        <footer class="main-footer">
            <div class="pull-right hidden-xs">
                <b>Version</b> 1.0
            </div>
            <strong>Copyright &copy; 2018 <a href="#">Abarrotes Monterrey S.A de C.V.</a></strong> Todos los Derechos Reservados.
        </footer>
    </div>

    <div class="modal fade" id="Modal_Exit">
        <div class="modal-dialog">
            <div class="modal-content">
                <div class="modal-header">
                    <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                        <span aria-hidden="true">&times;</span>
                    </button>
                    <h4 class="modal-title">Cerrar Sesion</h4>
                </div>
                <div class="modal-body">
                    <p>Se va a cerrar la session actual ¿Desea Continuar?&hellip;</p>
                </div>
                <div class="modal-footer">                    
                    <button type="button" class="btn btn-primary" onclick="CerrarSesion()">Si</button>
                    <button type="button" class="btn btn-default pull-left" data-dismiss="modal">No</button>
                </div>
            </div>
            <!-- /.modal-content -->
        </div>
        <!-- /.modal-dialog -->
    </div>
    <!-- /.modal -->   
    @{
        try
        {
            if (Session["id_usuario"].ToString() == "")
            {
                Response.Redirect("/Acceso/");
            }
        }
        catch (Exception ex)
        {            
            Response.Redirect("/Acceso/");
        }
    }    <!-- Jcrop -->
    @Scripts.Render("~/Content/js/Jcrop.js")

    <!-- Select-Picker -->
    @Scripts.Render("~/Content/js/bootstrap-select.min.js")
    @Scripts.Render("~/Content/plugins/bootstrap-sweetalert/sweet-alert.js")
    @Scripts.Render("~/Content/plugins/bootstrap-sweetalert/sweet-alert.min.js")
    @Scripts.Render("~/Content/plugins/bootstrap-datepicker/dist/js/bootstrap-datepicker.min.js")
    @Scripts.Render("~/Content/plugins/bootstrap-datepicker/dist/js/bootstrap-datepicker.min.js")
    <!-- Datatables-->
    @Scripts.Render("~/Content/plugins/datatables/jquery.dataTables.min.js")
    @Scripts.Render("~/Content/plugins/datatables/dataTables.bootstrap.js")
    @Scripts.Render("~/Content/plugins/datatables/dataTables.buttons.min.js")
    @Scripts.Render("~/Content/plugins/datatables/buttons.bootstrap.min.js")
    @Scripts.Render("~/Content/plugins/datatables/buttons.html5.min.js")
    @Scripts.Render("~/Content/plugins/datatables/dataTables.responsive.min.js")
    @Scripts.Render("~/Content/plugins/datatables/responsive.bootstrap.min.js")
    @Scripts.Render("~/Content/plugins/DataTables/jszip.min.js")
    @Scripts.Render("~/Content/plugins/DataTables/pdfmake.min.js")
    @Scripts.Render("~/Content/plugins/DataTables/vfs_fonts.js")
    <!-- Datatable init js -->
    @Scripts.Render("~/Content/pages/datatables.init.js")
    @*@Scripts.Render("~/bundles/jquery")
        @Scripts.Render("~/bundles/bootstrap")*@
    @RenderSection("scripts", required: false)



    <script>
        function CerrarSesion() {
            return window.location.href = "@Url.Action("CerrarSesion", "Acceso")";
        }
    </script>
       

        @* Add jquery code for Get Notification & setup signalr *@
        <script type="text/javascript">
        $(function () {
            // Click on notification icon for show notification
            $("#notificaciones").click(function (e) {
                e.stopPropagation();
                $("#contenidoNotificaciones").show();
                var count = 0;
                count = parseInt($('span.count').html()) || 0;
                //only load notification if not already loaded
                if (count > 0) {
                    updateNotification();
                }
                $("#notificaciones", this).html('&nbsp;');
            })
            // hide notifications
            $('html').click(function () {
                $("#contenidoNotificaciones").hide();
            })

        // update notification
        function Obtener_Tickets() {
            $('#menuNotificaciones').empty();
            $('#menuNotificaciones').append($('<li>Cargando...</li>'));
            $.ajax({
                destroy: true,
                searching: true,
                dataType: "json",                             
                url: '/Tickets/GetTickets/',
                contentType: "application/json; charset=utf-8",
                type: 'POST',
                success: function (datos) {                
                    $('#menuNotificaciones').empty();
                    if (datos.data.length == 0) {
                        $('#menuNotificaciones').append($('<li>Sin notificaciones</li>'));
                    }                    
                    $.each(datos.data, function (index, value) {
                        $('#menuNotificaciones').append($('<li><a href="#" onclick="Seguimiento(' + datos.data[index].id_ticket + ')"><i class="fa fa-ticket text-aqua"></i> ' + datos.data[index].asunto + '</a></li></li>'));
                    });
                },
                error: function (error) {
                    console.log(error);
                }
            })
        }

        function Seguimiento(id_ticket) {                
            if ("@Session["tipo_usuario"]" == "Supervisor") {
                window.location = "/Tickets/SeguimientoSucursal?id_ticket=" + id_ticket;
            }
        else {
                window.location = "/Tickets/SeguimientoMesaAyuda?id_ticket=" + id_ticket;
            }
        }
        

    </script>
       

        @* Add jquery code for Get Notification & setup signalr *@
        <script type="text/javascript">

       

        $(function () {
            //// Click on notification icon for show notification
            //$("#notificaciones").click(function (e) {
            //    debugger;
            //    e.stopPropagation();
            //    $('dropdown-menu').show();
            //    var count = 0;
            //    count = parseInt($('span.count').html()) || 0;
            //    //only load notification if not already loaded
            //    if (count > 0) {
            //        updateNotification();
            //    }
            //    $('dropdown-menu', this).html('&nbsp;');
            //})
            //// hide notifications
            //$('html').click(function () {
            //    $("#contenidoNotificaciones").hide();
            //})
            // update notification count
            function updateNotificationCount() {
                debugger;
                var count = 0;
                count = parseInt($("#numNotificaciones").html()) || 0;
                count++;
                $("#numNotificaciones").html(count);
            }
            // signalr js code for start hub and send receive notification
            var notificationHub = $.connection.notificationHub;
            $.connection.hub.start().done(function () {
                console.log('Notification hub started');
            });
            //signalr method for push server message to client
            notificationHub.client.notify = function (message) {
                debugger;
                if (message && message.toLowerCase() == "added") {
                    updateNotificationCount();
                    console.log('Notification Update');
                }
            }
        })
        </script>


</body>
</html>
